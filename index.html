<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Ombrelloni Spiaggia</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f4e4bc 0%, #e6d49f 50%, #d4c189 100%);
            font-family: Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        .controls {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .zoom-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .zoom-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .zoom-btn:hover {
            background: #45a049;
        }

        .beach-container {
            width: 100vw;
            height: 100vh;
            cursor: crosshair;
            transform-origin: 0 0;
            transition: transform 0.2s ease;
        }

        .umbrella {
            position: absolute;
            width: 60px;
            height: 60px;
            cursor: move;
            user-select: none;
        }

        .umbrella-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #4CAF50;
            border: 3px solid #2E7D32;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            position: relative;
            transition: background-color 0.3s ease;
        }

        .umbrella.open .umbrella-circle {
            background: #f44336;
            border-color: #c62828;
        }

        .umbrella-pole {
            position: absolute;
            width: 2px;
            height: 20px;
            background: #8D6E63;
            left: 50%;
            top: 100%;
            transform: translateX(-50%);
        }

        .delete-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .umbrella:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: #c62828;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
            max-width: 90%;
        }

        .modal h3 {
            margin-top: 0;
            color: #333;
        }

        .modal label {
            display: block;
            margin: 10px 0 5px 0;
            color: #555;
        }

        .modal input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .modal input[type="checkbox"] {
            margin-right: 8px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .save-btn {
            background: #4CAF50;
            color: white;
        }

        .save-btn:hover {
            background: #45a049;
        }

        .cancel-btn {
            background: #757575;
            color: white;
        }

        .cancel-btn:hover {
            background: #616161;
        }

        .confirm-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .confirm-content {
            background-color: white;
            margin: 20% auto;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
            max-width: 90%;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="controls">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoomIn()">+</button>
            <span id="zoom-level">100%</span>
            <button class="zoom-btn" onclick="zoomOut()">-</button>
        </div>
    </div>

    <div class="beach-container" id="beachContainer" onclick="addUmbrella(event)">
    </div>

    <!-- Modal per la modifica dell'ombrellone -->
    <div id="umbrellaModal" class="modal">
        <div class="modal-content">
            <h3>Modifica Ombrellone</h3>
            <label for="bedCount">Numero lettini:</label>
            <input type="number" id="bedCount" min="1" max="10" value="2">
            
            <label>
                <input type="checkbox" id="isOpen"> Aperto
            </label>
            
            <div class="modal-buttons">
                <button class="modal-btn save-btn" onclick="saveUmbrella()">Salva</button>
                <button class="modal-btn cancel-btn" onclick="closeModal()">Annulla</button>
            </div>
        </div>
    </div>

    <!-- Modal di conferma eliminazione -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-content">
            <h3>Conferma eliminazione</h3>
            <p>Sei sicuro di voler eliminare questo ombrellone?</p>
            <div class="modal-buttons">
                <button class="modal-btn save-btn" onclick="confirmDelete()">S√¨</button>
                <button class="modal-btn cancel-btn" onclick="cancelDelete()">No</button>
            </div>
        </div>
    </div>

    <script>
        let umbrellaCounter = 0;
        let currentZoom = 1;
        let currentUmbrella = null;
        let umbrellaToDelete = null;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;

        function addUmbrella(event) {
            if (isDragging || event.target !== event.currentTarget || event.target.closest('.umbrella')) return;

            const rect = event.currentTarget.getBoundingClientRect();
            const x = (event.clientX - rect.left) / currentZoom;
            const y = (event.clientY - rect.top) / currentZoom;

            const umbrella = document.createElement('div');
            umbrella.className = 'umbrella';
            umbrella.style.left = (x - 30) + 'px';
            umbrella.style.top = (y - 30) + 'px';
            umbrella.id = 'umbrella-' + (++umbrellaCounter);
            
            umbrella.innerHTML = `
                <div class="umbrella-circle">2</div>
                <div class="umbrella-pole"></div>
                <button class="delete-btn" onclick="deleteUmbrella('${umbrella.id}')" title="Elimina">üóëÔ∏è</button>
            `;

            umbrella.onclick = function(e) {
                e.stopPropagation();
                if (!isDragging) {
                    editUmbrella(umbrella);
                }
            };

            // Drag and drop per mouse
            umbrella.onmousedown = function(e) {
                if (e.target.classList.contains('delete-btn')) return;
                
                isDragging = false;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                
                const startX = parseInt(umbrella.style.left);
                const startY = parseInt(umbrella.style.top);
                
                function onMouseMove(e) {
                    const deltaX = e.clientX - dragStartX;
                    const deltaY = e.clientY - dragStartY;
                    
                    if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
                        isDragging = true;
                    }
                    
                    if (isDragging) {
                        umbrella.style.left = (startX + deltaX / currentZoom) + 'px';
                        umbrella.style.top = (startY + deltaY / currentZoom) + 'px';
                    }
                }
                
                function onMouseUp() {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    
                    setTimeout(() => {
                        isDragging = false;
                    }, 100);
                }
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
                e.preventDefault();
            };

            // Drag and drop per touch
            umbrella.ontouchstart = function(e) {
                if (e.target.classList.contains('delete-btn')) return;
                
                isDragging = false;
                const touch = e.touches[0];
                dragStartX = touch.clientX;
                dragStartY = touch.clientY;
                
                const startX = parseInt(umbrella.style.left);
                const startY = parseInt(umbrella.style.top);
                
                function onTouchMove(e) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - dragStartX;
                    const deltaY = touch.clientY - dragStartY;
                    
                    if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
                        isDragging = true;
                    }
                    
                    if (isDragging) {
                        umbrella.style.left = (startX + deltaX / currentZoom) + 'px';
                        umbrella.style.top = (startY + deltaY / currentZoom) + 'px';
                    }
                }
                
                function onTouchEnd() {
                    document.removeEventListener('touchmove', onTouchMove);
                    document.removeEventListener('touchend', onTouchEnd);
                    
                    setTimeout(() => {
                        isDragging = false;
                    }, 100);
                }
                
                document.addEventListener('touchmove', onTouchMove, { passive: false });
                document.addEventListener('touchend', onTouchEnd);
                e.preventDefault();
            };

            document.getElementById('beachContainer').appendChild(umbrella);
        }

        function editUmbrella(umbrella) {
            currentUmbrella = umbrella;
            const circle = umbrella.querySelector('.umbrella-circle');
            const bedCount = parseInt(circle.textContent);
            const isOpen = umbrella.classList.contains('open');
            
            document.getElementById('bedCount').value = bedCount;
            document.getElementById('isOpen').checked = isOpen;
            document.getElementById('umbrellaModal').style.display = 'block';
        }

        function saveUmbrella() {
            if (!currentUmbrella) return;
            
            const bedCount = document.getElementById('bedCount').value;
            const isOpen = document.getElementById('isOpen').checked;
            
            const circle = currentUmbrella.querySelector('.umbrella-circle');
            circle.textContent = bedCount;
            
            if (isOpen) {
                currentUmbrella.classList.add('open');
            } else {
                currentUmbrella.classList.remove('open');
            }
            
            closeModal();
        }

        function closeModal() {
            document.getElementById('umbrellaModal').style.display = 'none';
            currentUmbrella = null;
        }

        function deleteUmbrella(umbrellaId) {
            event.stopPropagation();
            umbrellaToDelete = document.getElementById(umbrellaId);
            document.getElementById('confirmModal').style.display = 'block';
        }

        function confirmDelete() {
            if (umbrellaToDelete) {
                umbrellaToDelete.remove();
                umbrellaToDelete = null;
            }
            document.getElementById('confirmModal').style.display = 'none';
        }

        function cancelDelete() {
            umbrellaToDelete = null;
            document.getElementById('confirmModal').style.display = 'none';
        }

        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 3);
            updateZoom();
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.3);
            updateZoom();
        }

        function updateZoom() {
            const container = document.getElementById('beachContainer');
            container.style.transform = `scale(${currentZoom})`;
            document.getElementById('zoom-level').textContent = Math.round(currentZoom * 100) + '%';
        }

        // Chiudi modal cliccando fuori
        window.onclick = function(event) {
            const modal = document.getElementById('umbrellaModal');
            const confirmModal = document.getElementById('confirmModal');
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === confirmModal) {
                cancelDelete();
            }
        }

        // Supporto touch per dispositivi mobili - solo per aggiungere ombrelloni
        document.getElementById('beachContainer').addEventListener('touchstart', function(e) {
            if (e.touches.length === 1 && !e.target.closest('.umbrella')) {
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('click', {
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    bubbles: true
                });
                this.dispatchEvent(mouseEvent);
            }
        });
    </script>
</body>
</html>